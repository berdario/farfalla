// Main Farfalla Library: includes the functions used to draw the toolbar and the reusable functions for plugins
$(function(){function a(){$("<div></div>").attr("id","farfalla_toolbar").addClass("farfalla_toolbar").addClass("ui-corner-left").prependTo("body"),$("<div></div>").attr("id","farfalla_toolbar_margin").appendTo("#farfalla_toolbar"),$("<div></div>").attr("id","farfalla_logo").appendTo("#farfalla_toolbar"),$("<div></div>").attr("id","farfalla_home").appendTo("#farfalla_toolbar"),$("<img></img>").attr({src:farfalla_path+"images/farfalla_icon.png",alt:"Farfalla logo - Click to hide or display the toolbar"}).appendTo("#farfalla_logo"),$("<a></a>").attr({id:"farfalla_home_link",href:"http://www.farfalla-project.org"}).appendTo("#farfalla_home"),$("<img></img>").attr({id:"farfalla_home_icon",src:farfalla_path+"/images/home_icon.png",alt:"Farfalla home - Link to the farfalla home page"}).appendTo("#farfalla_home_link"),$("<div></div>").attr("id","farfalla_handle").css("cursor","url('"+farfalla_path+"images/hand.png'), auto").appendTo("#farfalla_toolbar"),$("#farfalla_handle").mouseup(function(){$(this).css("cursor","url('"+farfalla_path+"images/hand.png'), auto")}),$("#farfalla_handle").mousedown(function(){$(this).css("cursor","url('"+farfalla_path+"images/grab.png'), auto")}),$("<div></div>").attr("id","farfalla_buttons").hide().appendTo("#farfalla_toolbar"),$("<ul></ul>").appendTo("#farfalla_buttons"),$("#farfalla_toolbar").draggable({handle:"#farfalla_handle",axis:"y",cursor:"url('"+farfalla_path+"images/grab.png'), auto",stop:function(){$.getJSON(farfalla_path+"backend/profiles/top/"+$(this).css("top")+"/?callback=?",{})}}).css("position","absolute")}function b(a){$("<div></div>").attr("id","farfalla_selection").appendTo("#farfalla_toolbar"),$("<form></form>").attr({id:"farfalla_toolbar_form",action:"#",method:"post"}).appendTo("#farfalla_selection"),$("<select></select>").attr({id:"farfalla_profile",name:"farfalla_profile"}).addClass("ui-corner-all").appendTo("#farfalla_toolbar_form"),$("<option></option>").addClass("choose").html("Loading...").appendTo("#farfalla_profile"),$("<option></option>").html("---").css("text-align","center").attr("disabled","disabled").appendTo("#farfalla_profile"),$.getJSON(farfalla_path+"backend/profiles/menu/?callback=?",{},function(a){$.each(a.profiles,function(){$("<option>").attr({value:this.Profile.id,title:this.descriptionTranslation[0].content,id:"farfalla_option_"+this.Profile.id}).text(this.nameTranslation[0].content).qtip({content:this.descriptionTranslation[0].content,position:{my:"top right",at:"bottom left",target:$("#farfalla_option_"+this.Profile.id)},style:{name:"dark"}}).appendTo("#farfalla_profile")}),$("#farfalla_profile option[class=choose]").html(a.ui.choose),$("#farfalla_logo").qtip({content:a.ui.logo,position:{my:"top right",at:"bottom center",target:$("#farfalla_logo")},style:"ui-tooltip-dark"}),$("#farfalla_handle").qtip({content:a.ui.handle,position:{my:"top right",at:"bottom center",target:$("#farfalla_handle")},style:"ui-tooltip-dark"}),$("#farfalla_home").qtip({content:a.ui.home,position:{my:"top right",at:"bottom center",target:$("#farfalla_home")},style:"ui-tooltip-dark"})})}function c(a){$("<div></div>").attr("id","farfalla_active").appendTo("#farfalla_toolbar"),$("<ul></ul>").appendTo("#farfalla_active"),$("<input></input>").attr({type:"button",id:"farfalla_change_profile",value:"loading ..."}).addClass("ui-corner-all").prependTo("#farfalla_active"),$.getJSON(farfalla_path+"backend/profiles/retrieve/"+a+"/?callback=?",{},function(a){$.each(a.description.Plugin,function(a,b){$("#farfalla_active ul").prepend("<li>"+b.name+"</li>"),$("#farfalla_selection").hide(),jQuery.getScript(farfalla_path+"plugins/"+b.name+"/"+b.name+".farfalla.js")}),$("#farfalla_change_profile").val(a.ui.reset)})}function d(){$("#farfalla_profile").change(function(){var a=$("#farfalla_profile").val();return $.getJSON(farfalla_path+"backend/profiles/retrieve/"+$("#farfalla_profile").val()+"/?callback=?",{},function(a){c($("#farfalla_profile").val()),e(),$("#farfalla_toolbar_form").fadeOut("slow"),$("#farfalla_active").fadeIn("slow"),h(0)}),!1})}function e(){$("#farfalla_change_profile").click(function(){$("#farfalla_active").fadeOut();var a=$.getJSON(farfalla_path+"backend/profiles/reset/?callback=?");a.complete(function(){window.location.reload()})})}function f(){$.getJSON(farfalla_path+"backend/profiles/status/?callback=?",{},function(a){i(a.top),a.id==null?(b(),d()):(c(a.id),e(),h(a.show))})}function g(){$("#farfalla_logo").toggle(function(){$("#farfalla_selection, #farfalla_active, #farfalla_home").hide("slow"),$.getJSON(farfalla_path+"backend/profiles/show/0/?callback=?",{})},function(){$("#farfalla_selection, #farfalla_active, #farfalla_home").show("slow"),$.getJSON(farfalla_path+"backend/profiles/show/1/?callback=?",{})})}function h(a){a==0&&($("#farfalla_selection, #farfalla_active, #farfalla_home").hide("slow"),$.getJSON(farfalla_path+"backend/profiles/show/0/?callback=?",{}))}function i(a){a!==null?$("#farfalla_toolbar").css("top",a):$("#farfalla_toolbar").css("top","30px")}$("<link>").attr("type","text/css").attr("rel","stylesheet").attr("href",farfalla_path+"css/jquery-ui-1.7.2.custom.css").prependTo("head"),$("<link>").attr("type","text/css").attr("rel","stylesheet").attr("href",farfalla_path+"css/farfalla.css").appendTo("head"),$("<link>").attr("type","text/css").attr("rel","stylesheet").attr("href",farfalla_path+"css/jquery.qtip.css").appendTo("head"),window.location.href.search(farfalla_path)=="-1"&&window.location.href.search("lisp8.formazione.unimib.it")=="-1"&&window.location==window.parent.location&&(a(),f(),g()),$.fn.farfalla_add_button=function(a,b,c,d,e,f,g){$("<li></li>").appendTo("#farfalla_buttons ul"),$("<input></input>").attr({value:b,type:"button",id:"button_"+c,accesskey:d}).css("cssText","background : "+e+" !important; border : 2px solid "+f+" !important; color : "+f+" !important;").addClass("ui-corner-all").addClass("plugin-button").appendTo("#farfalla_buttons ul li:last"),$("#button_"+c).click(g),$("#farfalla_buttons").show()},$.farfalla_get_option=function(a,b){$.getJSON(farfalla_path+"backend/plugins/get_option/"+a+"/?callback=?",{},b)},$.farfalla_set_option=function(a,b){b==null?$.getJSON(farfalla_path+"backend/plugins/set_option/"+a+"/?callback=?"):$.getJSON(farfalla_path+"backend/plugins/set_option/"+a+"/"+b+"/?callback=?")},$.getXPath=function(a){var b="";for(;a&&a.nodeType==1;a=a.parentNode){var c=$(a.parentNode).children(a.tagName).index(a)+1;c>1?c="["+c+"]":c="",b="/"+a.tagName.toLowerCase()+c+b}return b}});